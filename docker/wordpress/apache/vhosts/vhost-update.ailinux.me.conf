# ============================================================================
# Update Server VHost f√ºr update.ailinux.me
# Serves TriForce updates to all federation nodes
# ============================================================================

<VirtualHost *:80>
  ServerName update.ailinux.me
  RewriteEngine On
  RewriteRule ^/(.*)$ https://update.ailinux.me/$1 [R=301,L]
</VirtualHost>

<VirtualHost *:443>
  ServerName update.ailinux.me
  DocumentRoot /var/www/update.ailinux.me

  SSLEngine on
  SSLCertificateFile /etc/letsencrypt/live/ailinux.me/fullchain.pem
  SSLCertificateKeyFile /etc/letsencrypt/live/ailinux.me/privkey.pem

  # Security Headers
  Header always set X-Content-Type-Options "nosniff"
  Header always set X-Frame-Options "DENY"
  Header always set X-XSS-Protection "1; mode=block"

  # Allow directory listing for releases
  <Directory /var/www/update.ailinux.me>
    Options +Indexes
    AllowOverride None
    Require all granted
  </Directory>

  # JSON manifest endpoint
  <FilesMatch "\.json$">
    Header set Content-Type "application/json"
    Header set Access-Control-Allow-Origin "*"
  </FilesMatch>

  # Logs  
  ErrorLog /proc/self/fd/2
  CustomLog /proc/self/fd/1 combined
</VirtualHost>
